name: CI – Lint, Build & Test on dev

# dev 브랜치에 대한 PR과 푸시 이벤트를 모두 잡습니다.
on:
  pull_request:
    branches:
      - dev
  push:
    branches:
      - dev
      - main

jobs:
  lint_and_format:
    name: 🔍 Lint & Format Check
    runs-on: ubuntu-latest
    if: github.event_name == 'pull_request'
    strategy:
      matrix:
        node-version: [18.x]
    steps:
      # actions/checkout@v4로 리포지토리 코드를 가져옵니다.
      - name: Checkout code
        uses: actions/checkout@v4

      # actions/setup-node@v4로 매트릭스에 정의된 Node 버전을 설치·활성화
      - name: Setup Node.js ${{ matrix.node-version }}
        uses: actions/setup-node@v4
        with:
          node-version: ${{ matrix.node-version }}

      # npm ci로 package-lock.json 기반 의존성 설치
      - name: Install dependencies
        run: npm ci

      # npx biome check --quiet 로 코드 스타일·문법 오류만 검사(실제 수정 없음)
      - name: Run Biome lint (check only)
        run: npx biome check

      # npx biome format --check 로 포맷 에러 검사(자동 수정은 하지 않음)
      - name: Run Biome CI (lint & format check)
        run: npx biome ci

  build_and_test:
    name: 🏗️ Build & Test
    runs-on: ubuntu-latest
    needs: lint_and_format
    if: github.event_name == 'push'
    strategy:
      matrix:
        node-version: [18.x]
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js ${{ matrix.node-version }}
        uses: actions/setup-node@v4
        with:
          node-version: ${{ matrix.node-version }}

      - name: Install dependencies
        run: npm ci

      # vite build 등 실제 번들·컴파일 단계
      - name: Build project
        run: npm run build
